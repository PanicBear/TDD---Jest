# 좋은 테스트 원칙

복습: No
수강일: 2022년 1월 22일
유형: 이론

## 좋은 테스트의 비밀

- 한번 작성된 테스트 코드는 영원히 유지보수 해야한다
    - 때문에 테스트 코드일지라도 유지보수를 고려한 클린코드로 작성해야함
- 테스트 코드에서는 내부 구현사항을 테스트해서는 안됨
    - DI의 필요성
    - 사용자 입장에서 API만을 이용하여 작성해야함
        - 약간의 구현사항 변경으로도 테스트 코드가 무용지물(변수 이름 변경 등)
- 재사용성 높이기
    - 테스트를 위한 별도의 코드 작성을 통해 분리
        - 재사용 되는 함수, 모듈, 클래스 등
- 배포용 코드와 분리
    - 배포 시 테스트용 코드가 포함되지 않도록
        - mock
        - stub
        - 기타 테스트용 데이터 파일
- 테스트 코드를 통한 문서화

## 좋은 테스트의 구조

- Before
    - beforeEach
    - beforeAll
- Test(AAA or GWT)
    - 준비(Arrange, Given) ⇒ **준비과정 재사용**
        - 오브젝트 생성
        - 데이터 준비
    - 테스트 코드 실행(Act, When) ⇒ **의도적인 실패(반례)**
    - 실행된 값 검증(Assert, Then)
- After
    - afterAll
    - afterEach

```jsx
// Arrange, Given
const productService = new ProductService(new StubProductClient());

// Act, When
const items = await productService.fetchAvailableItems();

// Assert, Then
expect(items.length).toBe(1);
expect(items).toEqual([{item : 'Milk', available: true}]);
```

- 하나의 테스트에서 너무 많은 것을 검사하려고 하지는 않는지 생각해보기

## 좋은 테스트의 원칙(FIRST)

- Fast
    - 테스트 코드가 빠르게 수행될 수 있도록 **느린 것에 대한 의존성 낮추기**
        - 파일
        - 데이터베이스
        - 네트워크 등
    - Mock, Stub을 사용하기
    - 잦은 테스트 수행에도 무리가 없도록
    - 많은 테스트 수행으로 나은 코드가 되도록
- Isolated
    - **최소한의 유닛으로 검증**하여 독립적이고 집중적으로 유지
        - 어느 곳에서 테스트가 실패했는지 쉽게 판단할 수 있도록
- Repeatable
    - 실행할 때마다 동일한 결과를 유지해야한다
    - 불안정한 외부 환경에 의존하지 않아야 함
        - 다른 테스트 코드
        - 네트워크
- Self-Validating
    - 테스트 코드가 예상하거나 검증한 값의 결과, 위치 등을 자동적으로 반환해야 한다
    - 라이브러리의 사용
    - 기존 테스트 코드에 영향을 주는지 여부
        - 자동화를 통한 검증 단계 ⇒ CI / CD
- Timely
    - 시기적절하게 테스트 코드를 작성해야 한다
        - 코드 작성 중
        - 리팩토링 전
        - 배포 전
        

## 무엇을 테스트 해야할지 모를 때의 원칙(Right-BICEP)

- Right
    - 모든 요구 사항이 정상 동작 하는지 확인
    - 모든 결과가 정확한지 확인
- Boundary conditions
    - 모든 코너 케이스에 대해 테스트 하기
        - 형식이 잘못된 입력
        - null, undefined, 음수
        - 특수문자
        - 잘못된 이메일
        - 작은 숫자
        - 큰 숫자
        - 중복
        - 순서가 맞지 않을경우
- Inverse relationship
    - 역관계를 적용하여 결과값을 확인
        - 더한 것을 뺐을 때 동일한 결과값 확인
        - 배열에 추가한 것을 제외했을 때 결과값 확인
- Cross-check
    - 다른 수단을 이용하여 결과값이 맞는지 확인
        - 추가된 과일 === 전체 과일 - 예전의 과일 개수
        - A 알고리즘 === B 알고리즘
        - 알고리즘을 구현한 다른 라이브러리의 결과값을 통해서 직접 구현한 알고리즘의 정확성을 확인
- Error conditions
    - 에러 발생 시 구현 코드가 적절하게 동작 하는지
        - 네트워크 에러
        - 메모리 부족
        - 데이터베이스 중지 등
- Performance characteristics
    - 성능 확인은 테스트를 통해 정확한 수치로 확인해야한다
        - 성능 개선의 척도와 확인도 데이터로 확인
        

## 좋은 테스트의 커버리지(CORRECT)

- Conformance
    - 특정 형식을 준수
        - 전화번호
        - 이메일
        - 아이디
        - 파일 확장자 등
- Ordering
    - 순서 조건 확인
        - 배열의 순서 중요한 경우(id 순서 등)
- Range
    - 숫자의 범위
        - 제한된 범위보다 작거나 큰 경우
- Reference
    - 외부 의존성 유무
    - 특정 조건 유무
        - ~일때
        - ~가 되어 있을때
        - B 함수를 호출할 때, A 함수가 호출되어있지 않다면
        - 가정하고 있는 상황이 아닐 경우 어떤 상황이 발생하는지
- Existence
    - 값이 존재하지 않을때 어떻게 동작 하는지
        - null
        - undifined
        - 0
- Cardinality
    - 0-1-N 법칙에 따라 검증
    - 하나도 없는 경우
    - 하나만 있는 경우
    - 여러개 있는 경우
- Time
    - 상대, 절대, 동시의 일들
        - 순서가 맞지 않은 경우
        - 시간을 과하게 소비한 경우
        - 지역 시간